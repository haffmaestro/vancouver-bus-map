<!DOCTYPE html>
<meta charset="utf-8">
<style>
  .bus {
    fill: #434344;
    stroke-linejoin: round;
  }
</style>
<svg></svg>
<script src="d3.js"></script>
<script src="node_modules/d3-tile/build/d3-tile.js"></script>
<!-- <script src="d3-tile.js"></script> -->
<script src="src/d3Map.js"></script>

<script>
  tile = d3.tile;
  var [svg] = document.getElementsByTagName("svg"),
      width = window.innerWidth - 20,
      height = window.innerHeight - 20;

  d3Map.create(svg, {
    center: [-123.17, 49.26], 
    zoom: 21, 
    width, height
  })

  const projection = d3Map.getProjection();

  var path = d3.geoPath()
    .projection(projection);
  
  attachBuses();
  setInterval(attachBuses, 10000);
  // setTimeout(updateMap, 15000);

  function type(d) {
    const coordinates = [+d.Longitude, +d.Latitude];
    // This is GeoJSON notation 
    const instructions = {
      type: "Feature",
      geometry: {type: "Point", coordinates}
    }
    return instructions;
  }

  function attachBuses() {
    d3.json("https://api.18257440082045.stackery-stacks.io/buses", (error, buses) => {

      var busPaths = d3.select(svg).selectAll(".bus");
      
      // datum / data
      // datum is when you want to set the d3 data for an html object but the number of html objects
      // dont necessarily join 1 <> 1 with the data
      // data is when you want to have a 1 <> 1 relationship between the data and each html object
      // vectorLayer
      //   .datum({type: "FeatureCollection", features: buses.map(type)})
      //   .attr('d', path); // 'd' attribute is the attribute describes the svg element in SVG Path Mini Language

      busPaths
        .data(buses.map(type), (d) => d) 
        .enter()
          .append('path').attr('class', 'bus')
        .attr('d', path);

      busPaths
        .data(buses.map(type), (d) => d)
        .exit()
          .remove();
    })
  }

  function updateMap() {
    d3Map.update({zoom: 18});
  }

</script>
